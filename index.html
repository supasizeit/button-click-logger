<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clock In/Out Updater</title>
</head>
<body>

<button onclick="updateTime('Clock In')">Clock In</button>
<button onclick="updateTime('Clock Out')">Clock Out</button>

<script>
  async function updateTime(action) {
    const taskId = '860rydqew';  // Your task ID
    const apiUrl = `https://api.clickup.com/api/v2/task/${taskId}`;

    // Fetch the current task data
    const response = await fetch(apiUrl, {
        headers: {
            'Authorization': 'pk_3841409_T8B1RJC73DOVSSHB5OVY544KBEHARK38',  // Your ClickUp API token
        },
    });

    if (!response.ok) {
        console.error('Error fetching task data:', await response.text());
        return;
    }

    const taskData = await response.json();
    const currentDescription = taskData.description || '';

    // Format the date and time
    const now = new Date();
    const formattedDate = now.toLocaleString('en-GB', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false,
    }).replace(/, /g, ' ');

    // Append the new time entry to the existing description
    let newDescription = `${currentDescription}\n${action}: ${formattedDate}`;

    // If this is a clock-out action, calculate the total hours worked
    if (action === 'Clock Out') {
    const lines = newDescription.split('\n');
    let totalHoursWorked = 0;

    for (let i = 0; i < lines.length; i += 2) {
        if (lines[i].startsWith('Clock In') && lines[i + 1] && lines[i + 1].startsWith('Clock Out')) {
            const clockInTime = parseDate(lines[i].split(': ')[1]);
            const clockOutTime = parseDate(lines[i + 1].split(': ')[1]);
            totalHoursWorked += (clockOutTime - clockInTime) / (1000 * 60 * 60);  // Convert milliseconds to hours
        }
    }

    const expectedHours = 171;  // Expected hours for October 2023
    const accumulatedHours = totalHoursWorked - expectedHours;

    // Append the accumulated hours information to the new description
    newDescription += `\nAccumulated Hours: ${accumulatedHours.toFixed(2)}`;
    }

    // Helper function to parse date strings formatted as 'DD/MM/YYYY hh:mm:ss'
    function parseDate(dateString) {
        const [day, month, yearTime] = dateString.split('/');
        const [year, time] = yearTime.split(' ');
        const [hour, minute, second] = time.split(':');
        return new Date(year, month - 1, day, hour, minute, second);  // Note: month is 0-indexed
    }
    // Update the task with the new description
    const updateResponse = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'pk_3841409_T8B1RJC73DOVSSHB5OVY544KBEHARK38',  // Your ClickUp API token
        },
        body: JSON.stringify({
            description: newDescription,
        }),
    });

    if (updateResponse.ok) {
        const data = await updateResponse.json();
        console.log('Task updated successfully:', data);
    } else {
        console.error('Error updating task:', await updateResponse.text());
    }
}
</script>

</body>
</html>
